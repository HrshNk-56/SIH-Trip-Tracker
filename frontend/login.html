<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map My Way</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, hsl(175, 60%, 40%), hsl(185, 45%, 70%)); /* Backwater gradient */
            color: hsl(45, 20%, 98%); /* Coconut white */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        h1 {
            font-family: 'Montserrat', sans-serif;
        }
        .error-message {
            color: hsl(10, 75%, 55%); /* Coral red */
            font-size: 14px;
            margin-top: 8px;
            text-align: center;
        }
        .success-message {
            color: hsl(145, 60%, 35%); /* Deep palm green */
            font-size: 14px;
            margin-top: 8px;
            text-align: center;
        }
        .hidden { display: none !important; }
        .loading { opacity: 0.7; pointer-events: none; }
        
        /* Kerala coastal styling */
        .login-card {
            background: linear-gradient(145deg, hsl(45, 20%, 98%), hsl(40, 35%, 92%)); /* Coconut to sand */
            border: 2px solid hsl(180, 20%, 80%); /* Light driftwood border */
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .input-field {
            background: hsl(45, 30%, 95%) !important; /* Sea foam white */
            border: 1px solid hsl(180, 20%, 80%) !important;
            color: hsl(25, 50%, 15%) !important; /* Deep coconut brown */
        }
        
        .input-field:focus {
            border-color: hsl(15, 85%, 55%) !important; /* Sunset orange focus */
            box-shadow: 0 0 0 2px hsl(15, 85%, 55%, 0.2) !important;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, hsl(15, 85%, 55%), hsl(25, 80%, 65%)) !important; /* Kovalam sunset */
            border: none !important;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, hsl(15, 85%, 50%), hsl(25, 80%, 60%)) !important;
            transform: translateY(-1px);
            box-shadow: 0 8px 20px hsl(15, 85%, 55%, 0.3);
        }
        
        .social-btn-red {
            background: linear-gradient(135deg, hsl(10, 75%, 55%), hsl(15, 80%, 60%)) !important; /* Coral gradient */
        }
        
        .social-btn-blue {
            background: linear-gradient(135deg, hsl(175, 60%, 40%), hsl(185, 45%, 70%)) !important; /* Backwater gradient */
        }
        
        .link-accent {
            color: hsl(15, 85%, 55%) !important; /* Sunset orange links */
        }
        
        .text-main {
            color: hsl(25, 50%, 15%) !important; /* Deep coconut brown */
        }
        
        .text-muted {
            color: hsl(25, 30%, 45%) !important; /* Weathered driftwood */
        }
    </style>
</head>
<body class="bg-black p-4 sm:p-8">
<div class="login-card rounded-[4rem] p-8 sm:p-12 w-full max-w-lg shadow-2xl flex flex-col items-center">

    <!-- Image Slider -->
    <div class="relative w-60 h-60 overflow-hidden rounded-full mb-6 shadow-lg mx-auto">
        <img id="sliderImage" src="" alt="Travel destination image" class="w-full h-full object-cover transition-opacity duration-500 ease-in-out">
    </div>

    <h1 class="text-5xl md:text-6xl font-bold text-center text-main mb-2">
        Map My Way
    </h1>
    <p class="text-lg md:text-xl font-medium text-center text-muted mb-8">
        From dream to destination
    </p>

    <!-- Login Form -->
    <form id="loginForm" class="w-full space-y-4 mb-6">
        <div class="relative flex items-center bg-gray-800 rounded-full py-4 px-6 focus-within:ring-2 focus-within:ring-orange-500 transition-all duration-300">
                <span class="text-gray-500 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </span>
            <input id="email" name="email" type="email" placeholder="Email or Phone Number" class="input-field w-full bg-transparent outline-none border-none text-lg placeholder-gray-500" required />
        </div>

        <div class="relative flex items-center bg-gray-800 rounded-full py-4 px-6 focus-within:ring-2 focus-within:ring-orange-500 transition-all duration-300">
                <span class="text-gray-500 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </span>
            <input id="password" name="password" type="password" placeholder="Password" class="input-field w-full bg-transparent outline-none border-none text-lg placeholder-gray-500" required />
        </div>

        <div class="text-right text-sm md:text-base">
            <a href="#" class="link-accent font-semibold hover:underline">Forgot your password?</a>
        </div>

        <div id="generalError" class="error-message hidden"></div>
        <div id="successMessage" class="success-message hidden"></div>

        <button type="submit" id="loginButton" class="btn-primary w-full text-white font-bold text-xl py-4 rounded-full shadow-lg transition-all duration-300">
            <span id="loginText">Sign In</span>
            <span id="loadingText" class="hidden">Signing In...</span>
        </button>
    </form>

    <!-- Registration Form (Hidden by default) -->
    <form id="registerForm" class="w-full space-y-4 mb-6 hidden">
        <div class="text-center mb-4">
            <h2 class="text-3xl font-bold text-white">Create Account</h2>
            <p class="text-gray-400">Join Map My Way today!</p>
        </div>

        <!-- First Name & Last Name Row -->
        <div class="grid grid-cols-2 gap-4">
            <div class="relative flex items-center bg-gray-800 rounded-full py-4 px-6 focus-within:ring-2 focus-within:ring-orange-500 transition-all duration-300">
                <input id="firstName" name="firstName" type="text" placeholder="First Name" class="w-full bg-transparent outline-none border-none text-lg text-white placeholder-gray-500" required />
            </div>
            <div class="relative flex items-center bg-gray-800 rounded-full py-4 px-6 focus-within:ring-2 focus-within:ring-orange-500 transition-all duration-300">
                <input id="lastName" name="lastName" type="text" placeholder="Last Name" class="w-full bg-transparent outline-none border-none text-lg text-white placeholder-gray-500" required />
            </div>
        </div>

        <!-- Email -->
        <div class="relative flex items-center bg-gray-800 rounded-full py-4 px-6 focus-within:ring-2 focus-within:ring-orange-500 transition-all duration-300">
                <span class="text-gray-500 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </span>
            <input id="regEmail" name="email" type="email" placeholder="Email Address" class="w-full bg-transparent outline-none border-none text-lg text-white placeholder-gray-500" required />
        </div>

        <!-- Phone Number -->
        <div class="relative flex items-center bg-gray-800 rounded-full py-4 px-6 focus-within:ring-2 focus-within:ring-orange-500 transition-all duration-300">
                <span class="text-gray-500 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                </span>
            <input id="phoneNumber" name="phoneNumber" type="tel" placeholder="Phone Number" class="w-full bg-transparent outline-none border-none text-lg text-white placeholder-gray-500" required />
        </div>

        <!-- Password -->
        <div class="relative flex items-center bg-gray-800 rounded-full py-4 px-6 focus-within:ring-2 focus-within:ring-orange-500 transition-all duration-300">
                <span class="text-gray-500 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </span>
            <input id="regPassword" name="password" type="password" placeholder="Create Password" class="w-full bg-transparent outline-none border-none text-lg text-white placeholder-gray-500" required />
        </div>

        <div id="registerError" class="error-message hidden"></div>
        <div id="registerSuccess" class="success-message hidden"></div>

        <button type="submit" id="registerButton" class="w-full bg-orange-500 text-white font-bold text-xl py-4 rounded-full shadow-lg hover:bg-orange-600 transition-colors duration-300">
            <span id="registerText">Create Account</span>
            <span id="registerLoadingText" class="hidden">Creating Account...</span>
        </button>

        <div class="text-center">
            <button type="button" id="showLogin" class="text-orange-500 font-bold hover:underline">Back to Sign In</button>
        </div>
    </form>

    <!-- Social Login Buttons (only shown for login) -->
    <div id="socialButtons" class="w-full space-y-4">
        <div class="text-center text-gray-400 font-medium my-4">or</div>
        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
            <button class="social-btn-red flex-1 flex items-center justify-center text-white font-bold text-lg py-4 rounded-full shadow-lg hover:opacity-90 transition-all duration-300">
                <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0h-21.35c-.733 0-1.325.592-1.325 1.325v21.35c0 .733.592 1.325 1.325 1.325h11.455v-9.293h-3.136v-3.646h3.136v-2.673c0-3.111 1.89-4.802 4.654-4.802 1.325 0 2.463.098 2.793.142v3.238l-1.921.001c-1.503 0-1.8.715-1.8 1.764v2.316h3.587l-.54 3.646h-3.047v9.293h6.103c.733 0 1.325-.592 1.325-1.325v-21.35c0-.733-.592-1.325-1.325-1.325z"/></svg>
                Facebook
            </button>
            <button class="social-btn-blue flex-1 flex items-center justify-center text-white font-bold text-lg py-4 rounded-full shadow-lg hover:opacity-90 transition-all duration-300">
                <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12z"/></svg>
                Google
            </button>
        </div>
    </div>

    <!-- Sign Up Link (only shown for login) -->
    <p id="signUpLink" class="text-sm md:text-base mt-8 text-muted">
        Don't have an account? <a href="#" id="showRegister" class="link-accent font-bold hover:underline">Sign Up</a>
    </p>
</div>

<script>
    const API_BASE_URL = 'http://localhost:8080';
    let authCheckInProgress = false;
    let hasCheckedAuth = false;

    // Image slider (your original code)
    const imageFiles = [
        "https://www.touropia.com/gfx/b/2011/09/hawa_mahal.jpg",
        "https://media.istockphoto.com/id/537988165/photo/varanasi.webp?a=1&b=1&s=612x612&w=0&k=20&c=12qNJSzaD01LG-v0C0VZhv6tp7HTLnGtBK-a0rvpRiw=",
        "https://images.pexels.com/photos/3361480/pexels-photo-3361480.jpeg",
        "https://images.pexels.com/photos/12772456/pexels-photo-12772456.jpeg",
        "https://images.pexels.com/photos/5202289/pexels-photo-5202289.jpeg",
        "https://images.pexels.com/photos/3370598/pexels-photo-3370598.jpeg"
    ];

    let currentSlide = 0;
    const sliderImage = document.getElementById('sliderImage');

    function showSlide(index) {
        sliderImage.src = imageFiles[index];
        currentSlide = index;
    }

    function nextSlide() {
        currentSlide = (currentSlide + 1) % imageFiles.length;
        showSlide(currentSlide);
    }

    let slideInterval = setInterval(nextSlide, 3000);

    document.querySelector('.relative.w-60').addEventListener('mouseenter', () => {
        clearInterval(slideInterval);
    });
    document.querySelector('.relative.w-60').addEventListener('mouseleave', () => {
        slideInterval = setInterval(nextSlide, 3000);
    });

    // DOM Elements
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const showRegisterBtn = document.getElementById('showRegister');
    const showLoginBtn = document.getElementById('showLogin');
    const socialButtons = document.getElementById('socialButtons');
    const signUpLink = document.getElementById('signUpLink');

    // Toggle between login and register forms
    showRegisterBtn.addEventListener('click', (e) => {
        e.preventDefault();
        loginForm.classList.add('hidden');
        registerForm.classList.remove('hidden');
        socialButtons.classList.add('hidden');
        signUpLink.classList.add('hidden');
    });

    showLoginBtn.addEventListener('click', () => {
        registerForm.classList.add('hidden');
        loginForm.classList.remove('hidden');
        socialButtons.classList.remove('hidden');
        signUpLink.classList.remove('hidden');
    });

    // Utility functions
    function showError(elementId, message) {
        document.getElementById(elementId).textContent = message;
        document.getElementById(elementId).classList.remove('hidden');
    }

    function hideError(elementId) {
        document.getElementById(elementId).classList.add('hidden');
    }

    function showSuccess(elementId, message) {
        document.getElementById(elementId).textContent = message;
        document.getElementById(elementId).classList.remove('hidden');
    }

    function setLoading(formType, isLoading) {
        const button = document.getElementById(formType + 'Button');
        const text = document.getElementById(formType + 'Text');
        const loading = document.getElementById(formType === 'login' ? 'loadingText' : 'registerLoadingText');

        if (isLoading) {
            button.classList.add('loading');
            text.classList.add('hidden');
            loading.classList.remove('hidden');
        } else {
            button.classList.remove('loading');
            text.classList.remove('hidden');
            loading.classList.add('hidden');
        }
    }

    // Login form handler
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        hideError('generalError');
        hideError('successMessage');

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
            showError('generalError', 'Please fill in all fields.');
            return;
        }

        setLoading('login', true);

        try {
            console.log('Attempting login...', { email });
            const response = await fetch(`${API_BASE_URL}/api/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ email, password })
            });

            console.log('Login response:', response.status, response.statusText);

            if (response.ok) {
                const data = await response.json();
                console.log('Login successful:', data);
                showSuccess('successMessage', 'Login successful! Redirecting...');
                console.log('About to redirect to:', 'http://localhost:3000/');
                console.log('Redirecting immediately...');
                window.location.href = 'http://localhost:3000/';
            } else {
                const data = await response.json();
                console.log('Login failed:', data);
                showError('generalError', data.message || data.error || 'Login failed.');
            }
        } catch (error) {
            showError('generalError', 'Backend server not running. Please start your Go server.');
        } finally {
            setLoading('login', false);
        }
    });

    // Registration form handler - THIS IS THE MISSING PART!
    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        hideError('registerError');
        hideError('registerSuccess');

        const formData = new FormData(registerForm);
        const data = {
            firstName: formData.get('firstName'),
            lastName: formData.get('lastName'),
            email: formData.get('email'),
            password: formData.get('password'),
            phoneNumber: formData.get('phoneNumber')
        };

        // Validation
        if (!data.firstName || !data.lastName || !data.email || !data.password || !data.phoneNumber) {
            showError('registerError', 'Please fill in all fields.');
            return;
        }

        setLoading('register', true);

        try {
            console.log('Registering user:', data);

            const response = await fetch(`${API_BASE_URL}/api/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify(data)
            });

            const result = await response.json();
            console.log('Registration response:', result);

            if (response.ok) {
                showSuccess('registerSuccess', 'Account created successfully! You can now log in.');
                setTimeout(() => {
                    // Switch back to login form and fill the email
                    registerForm.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                    socialButtons.classList.remove('hidden');
                    signUpLink.classList.remove('hidden');
                    document.getElementById('email').value = data.email;
                }, 2000);
            } else {
                showError('registerError', result.error || result.message || 'Registration failed.');
            }
        } catch (error) {
            console.error('Registration error:', error);
            showError('registerError', 'Network error. Please check if the server is running.');
        } finally {
            setLoading('register', false);
        }
    });

    // Initialize
    window.onload = function() {
        showSlide(currentSlide);
    };
</script>
</body>
</html>
